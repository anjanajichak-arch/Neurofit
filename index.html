<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroFit - Advanced Brain Training</title>
    <style>
        :root {
            /* Theme Variables - Dynamic */
            --hue: 250; 
            --primary: hsl(var(--hue), 70%, 60%);
            --primary-dark: hsl(var(--hue), 70%, 45%);
            --primary-light: hsl(var(--hue), 70%, 90%);
            
            /* UI Variables */
            --bg-dark: #12121a;
            --bg-panel: #1e1e28;
            --text-main: #ffffff;
            --text-muted: #8b8b9e;
            --success: #00b894;
            --danger: #ff7675;
            --glass: rgba(30, 30, 40, 0.7);
            --glass-border: rgba(255, 255, 255, 0.05);
            --radius: 20px;
            --shadow: 0 15px 35px rgba(0,0,0,0.3);
            --font-main: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent; 
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            transition: background 0.5s ease;
        }

        /* --- Header & Nav --- */
        header {
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(18, 18, 26, 0.95);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--glass-border);
        }

        .brand {
            font-size: 1.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .brand span { 
            color: var(--primary); 
            transition: color 0.3s; 
        }
        .brand:hover span {
            color: var(--primary-light);
        }

        .nav-controls { 
            display: flex; 
            align-items: center; 
            gap: 20px; 
        }

        .score-pill {
            background: rgba(255,255,255,0.05);
            padding: 0.5rem 1.2rem;
            border-radius: 50px;
            font-weight: 600;
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .score-pill span { 
            color: var(--primary);
            font-size: 1.1rem;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--text-main);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s;
            position: relative;
        }
        .icon-btn:hover { 
            background: rgba(255,255,255,0.1); 
            transform: rotate(15deg);
        }
        .icon-btn.active { 
            background: var(--primary);
            color: white;
        }

        /* --- Layout --- */
        main {
            flex: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        .view { 
            display: none; 
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); 
        }
        .view.active { 
            display: block; 
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes celebrate {
            0% { transform: translateY(0) rotate(0); }
            25% { transform: translateY(-10px) rotate(5deg); }
            50% { transform: translateY(0) rotate(0); }
            75% { transform: translateY(-10px) rotate(-5deg); }
        }

        /* --- Dashboard --- */
        .hero {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }
        .hero::before {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            filter: blur(60px);
            opacity: 0.1;
            z-index: -1;
        }
        .hero h1 { 
            font-size: 3rem; 
            margin-bottom: 0.5rem; 
            letter-spacing: -1px;
            background: linear-gradient(90deg, var(--text-main), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .hero p { 
            color: var(--text-muted); 
            font-size: 1.1rem; 
            max-width: 600px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-panel);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .stat-icon {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .stat-info h4 {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        .stat-info p {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .game-card {
            background: var(--bg-panel);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .game-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow), 0 0 30px rgba(var(--hue), 70%, 60%, 0.2);
            border-color: var(--primary-light);
        }
        .game-card:hover::before { transform: scaleX(1); }

        .card-icon {
            width: 80px; height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }
        .game-card:hover .card-icon { 
            transform: scale(1.1) rotate(5deg); 
            animation: pulse 1s infinite;
        }

        .game-card h3 { 
            font-size: 1.4rem; 
            margin-bottom: 0.5rem; 
        }
        .game-card p { 
            color: var(--text-muted); 
            font-size: 0.9rem; 
            line-height: 1.5; 
            margin-bottom: 1.5rem; 
            flex-grow: 1;
        }
        
        .level-badge {
            background: rgba(var(--hue), 70%, 60%, 0.1);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
            border: 1px solid rgba(var(--hue), 70%, 60%, 0.2);
        }

        /* --- Game Interface --- */
        .game-interface {
            background: var(--bg-panel);
            border-radius: var(--radius);
            padding: 2.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-border);
            position: relative;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--glass-border);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .game-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .game-title {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .game-level {
            color: var(--primary);
            font-weight: 600;
            font-size: 0.9rem;
            padding: 4px 12px;
            background: rgba(var(--hue), 70%, 60%, 0.1);
            border-radius: 20px;
        }

        .game-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            margin: 1.5rem 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .btn-main {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .btn-main::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn-main:hover::before {
            left: 100%;
        }
        .btn-main:hover { 
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(var(--hue), 70%, 60%, 0.3);
        }
        .btn-main:active { 
            transform: translateY(0); 
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--text-main);
            border: 1px solid var(--glass-border);
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--primary);
        }

        .btn-text {
            background: none; 
            border: none; 
            color: var(--text-muted);
            cursor: pointer; 
            font-size: 0.9rem; 
            display: flex; 
            align-items: center; 
            gap: 8px;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .btn-text:hover { 
            color: var(--text-main); 
            background: rgba(255,255,255,0.05);
        }

        /* --- Game: Memory Grid --- */
        .memory-grid {
            display: grid;
            gap: 10px;
            margin: 0 auto;
            width: fit-content;
        }
        .mem-tile {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        .mem-tile::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary);
            transform: scale(0);
            transition: transform 0.2s;
            border-radius: 8px;
        }
        .mem-tile.active::after {
            transform: scale(1);
        }
        .mem-tile.found {
            background: var(--success);
            transform: scale(0.95);
            box-shadow: 0 0 20px var(--success);
        }
        .mem-tile.wrong {
            background: var(--danger);
            animation: shake 0.3s;
        }

        /* --- Game: Pattern --- */
        .pattern-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }
        
        .pattern-row { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 20px; 
            margin: 30px 0; 
        }
        
        .pat-item { 
            width: 60px; 
            height: 60px; 
            background: var(--primary); 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-weight: bold; 
            font-size: 1.4rem;
            box-shadow: 0 4px 15px rgba(var(--hue), 70%, 60%, 0.3);
            transition: transform 0.2s;
        }
        
        .pat-item.q { 
            background: transparent; 
            border: 2px dashed var(--text-muted); 
            color: var(--text-muted); 
        }
        
        .pat-options { 
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            flex-wrap: wrap;
        }
        
        .pat-opt {
            width: 60px; 
            height: 60px; 
            border-radius: 12px;
            border: 2px solid var(--primary); 
            background: transparent;
            color: white; 
            font-size: 1.4rem; 
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pat-opt:hover { 
            background: rgba(255,255,255,0.1); 
            transform: translateY(-2px);
        }
        
        .pat-opt.correct {
            background: var(--success);
            border-color: var(--success);
            animation: celebrate 0.5s;
        }
        
        .pat-opt.incorrect {
            background: var(--danger);
            border-color: var(--danger);
            animation: shake 0.3s;
        }

        /* --- Game: Math --- */
        .math-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }
        
        .math-display { 
            font-size: 4rem; 
            font-weight: 800; 
            font-family: monospace; 
            color: white;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .math-input {
            background: rgba(0,0,0,0.3); 
            border: 2px solid rgba(255,255,255,0.1);
            color: white; 
            font-size: 1.8rem; 
            padding: 15px;
            width: 200px; 
            text-align: center; 
            border-radius: 12px;
            outline: none;
            font-family: monospace;
        }
        
        .math-input:focus { 
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(var(--hue), 70%, 60%, 0.3);
        }
        
        .math-input.correct {
            border-color: var(--success);
            background: rgba(0, 184, 148, 0.1);
        }
        
        .math-input.incorrect {
            border-color: var(--danger);
            background: rgba(255, 118, 117, 0.1);
        }
        
        .time-display {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            padding: 8px 16px;
            background: rgba(var(--hue), 70%, 60%, 0.1);
            border-radius: 20px;
        }

        /* --- Game: Tic Tac Toe --- */
        .ttt-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }
        
        .ttt-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 300px; 
            margin: 0 auto;
        }
        
        .ttt-cell {
            width: 100%; 
            aspect-ratio: 1;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 3rem; 
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .ttt-cell:hover { 
            background: rgba(255,255,255,0.1); 
        }
        
        .ttt-cell.x { 
            color: var(--danger); 
        }
        
        .ttt-cell.o { 
            color: var(--success); 
        }
        
        .ttt-cell.win {
            background: rgba(var(--hue), 70%, 60%, 0.2);
            animation: pulse 1s infinite;
        }
        
        .ttt-info { 
            text-align: center; 
            font-size: 1.1rem;
            color: var(--text-muted); 
        }
        
        .ttt-score {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }
        
        .ttt-score-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius);
            min-width: 100px;
        }
        
        .ttt-score-item span:first-child {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        
        .ttt-score-item span:last-child {
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex; 
            align-items: center; 
            justify-content: center;
            opacity: 0; 
            pointer-events: none; 
            transition: opacity 0.3s;
        }
        
        .modal-overlay.active { 
            opacity: 1; 
            pointer-events: all; 
        }
        
        .modal-box {
            background: var(--bg-panel);
            padding: 3rem;
            border-radius: var(--radius);
            width: 90%; 
            max-width: 500px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transform: scale(0.9) translateY(20px); 
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .modal-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }
        
        .modal-overlay.active .modal-box { 
            transform: scale(1) translateY(0); 
        }

        .modal-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: celebrate 1s infinite;
        }

        .modal-title { 
            font-size: 2rem; 
            margin-bottom: 1rem; 
        }

        .modal-score { 
            font-size: 4rem; 
            color: var(--primary); 
            font-weight: bold; 
            margin: 1rem 0; 
        }

        .modal-message { 
            color: var(--text-muted); 
            margin-bottom: 2rem; 
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        /* Settings Specific */
        .settings-grid { 
            display: grid; 
            gap: 20px; 
            text-align: left; 
            margin-bottom: 2rem;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .color-picker { 
            display: flex; 
            gap: 10px; 
            justify-content: center; 
            margin-top: 10px; 
        }
        
        .color-dot { 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            cursor: pointer; 
            border: 3px solid transparent; 
            transition: all 0.2s;
            position: relative;
        }
        
        .color-dot::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.2rem;
            opacity: 0;
        }
        
        .color-dot.active { 
            border-color: white;
            transform: scale(1.1);
        }
        
        .color-dot.active::after {
            opacity: 1;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2.2rem; }
            .math-display { font-size: 2.8rem; }
            .game-interface { padding: 1.5rem; }
            .game-grid { grid-template-columns: 1fr; }
            .modal-buttons { flex-direction: column; }
            .ttt-grid { width: 250px; }
        }

        @media (max-width: 480px) {
            header { padding: 1rem; }
            main { padding: 1rem; }
            .hero h1 { font-size: 1.8rem; }
            .pat-item, .pat-opt { width: 50px; height: 50px; font-size: 1.2rem; }
            .ttt-grid { width: 200px; }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-panel);
            border: 1px solid var(--glass-border);
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1001;
            box-shadow: var(--shadow);
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-icon {
            font-size: 1.2rem;
        }
        
        .toast-message {
            font-size: 0.9rem;
        }

        /* Tutorial Overlay */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .tutorial-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .tutorial-content {
            background: var(--bg-panel);
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 500px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }
        
        .tutorial-content h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .tutorial-content p {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        /* Level Selector */
        .level-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin: 2rem 0;
        }
        
        .level-option {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .level-option:hover {
            background: rgba(var(--hue), 70%, 60%, 0.2);
            border-color: var(--primary);
        }
        
        .level-option.completed {
            background: rgba(0, 184, 148, 0.2);
            border-color: var(--success);
            color: var(--success);
        }
        
        .level-option.current {
            background: rgba(var(--hue), 70%, 60%, 0.3);
            border-color: var(--primary);
            color: var(--primary);
            transform: scale(1.1);
        }
    </style>
</head>
<body>

    <header>
        <div class="brand" onclick="app.showHome()">
            üß† Neuro<span>Fit</span>
        </div>
        <div class="nav-controls">
            <div class="score-pill">
                ‚ö° <span id="headerScore">0</span>
                <span style="color:var(--text-muted);">|</span>
                üéØ <span id="headerLevel">1</span>
            </div>
            <button class="icon-btn" onclick="app.showStats()">üìä</button>
            <button class="icon-btn" onclick="app.toggleSettings()">‚öôÔ∏è</button>
        </div>
    </header>

    <main>
        <!-- DASHBOARD -->
        <section id="dashboard" class="view active">
            <div class="hero">
                <h1>Advanced Brain Training</h1>
                <p>Enhance your cognitive abilities with 200+ challenging levels across 4 different game modes.</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-info">
                        <h4>Current Streak</h4>
                        <p id="streakCount">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-info">
                        <h4>Training Time</h4>
                        <p id="trainingTime">0m</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-info">
                        <h4>High Score</h4>
                        <p id="highScore">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üß©</div>
                    <div class="stat-info">
                        <h4>Games Played</h4>
                        <p id="gamesPlayed">0</p>
                    </div>
                </div>
            </div>

            <div class="game-grid">
                <div class="game-card" onclick="app.loadGame('memory')">
                    <div class="card-icon">üß©</div>
                    <h3>Spatial Recall</h3>
                    <p>Memorize complex grid patterns. Grids expand up to 6x6 as you progress.</p>
                    <div class="level-badge" id="memoryLevel">Level 1</div>
                </div>

                <div class="game-card" onclick="app.loadGame('pattern')">
                    <div class="card-icon">üîÆ</div>
                    <h3>Pattern Logic</h3>
                    <p>Identify the missing element in abstract and mathematical sequences.</p>
                    <div class="level-badge" id="patternLevel">Level 1</div>
                </div>

                <div class="game-card" onclick="app.loadGame('math')">
                    <div class="card-icon">‚ö°</div>
                    <h3>Mental Math</h3>
                    <p>Speed solving. Operations include +, -, √ó, √∑ with increasing difficulty.</p>
                    <div class="level-badge" id="mathLevel">Level 1</div>
                </div>

                <div class="game-card" onclick="app.loadGame('tictactoe')">
                    <div class="card-icon">‚ùå‚≠ï</div>
                    <h3>Strategy Tac-Toe</h3>
                    <p>Play against an Unbeatable AI (Minimax). Perfect for training logic.</p>
                    <div class="level-badge">Infinite</div>
                </div>
            </div>
        </section>

        <!-- GAME CONTAINER -->
        <section id="gameScreen" class="view">
            <div class="game-interface">
                <div class="game-header">
                    <div class="game-info">
                        <button class="btn-text" onclick="app.showHome()">
                            ‚Üê Back to Menu
                        </button>
                        <div class="game-title" id="gameTitle">Game Title</div>
                        <div class="game-level" id="gameLevel">Level 1</div>
                    </div>
                    <div class="game-controls">
                        <div id="gameTimer" class="time-display" style="display:none;">00:00</div>
                        <button class="icon-btn" onclick="app.pauseGame()" id="pauseBtn">‚è∏Ô∏è</button>
                        <button class="icon-btn" onclick="app.showTutorial()" id="helpBtn">‚ùî</button>
                    </div>
                </div>

                <div class="progress-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>

                <div id="gameArea" style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                    <!-- Game Content Injected Here -->
                </div>
            </div>
        </section>
    </main>

    <!-- RESULT MODAL -->
    <div id="resultModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-icon" id="resIcon">üéØ</div>
            <h2 class="modal-title" id="resTitle">Level Complete</h2>
            <div class="modal-score" id="resScore">+100</div>
            <p class="modal-message" id="resMsg">Your cognitive abilities are improving!</p>
            <div class="modal-buttons">
                <button class="btn-main" onclick="app.nextLevel()">Next Level</button>
                <button class="btn-secondary" onclick="app.showHome()">Return to Menu</button>
            </div>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-box">
            <h2>Settings</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <span>Theme Color</span>
                    <div class="color-picker">
                        <div class="color-dot active" style="background: #8e44ad;" onclick="app.setTheme(250, this)"></div>
                        <div class="color-dot" style="background: #2980b9;" onclick="app.setTheme(210, this)"></div>
                        <div class="color-dot" style="background: #27ae60;" onclick="app.setTheme(145, this)"></div>
                        <div class="color-dot" style="background: #e67e22;" onclick="app.setTheme(30, this)"></div>
                        <div class="color-dot" style="background: #e74c3c;" onclick="app.setTheme(0, this)"></div>
                    </div>
                </div>
                <div class="setting-item">
                    <span>Sound Effects</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="soundToggle" checked onchange="app.toggleSound(this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Vibration</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="vibrationToggle" checked onchange="app.toggleVibration(this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Animations</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="animationsToggle" checked onchange="app.toggleAnimations(this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn-main" onclick="app.resetProgress()">Reset Progress</button>
                <button class="btn-secondary" onclick="app.toggleSettings()">Close</button>
            </div>
        </div>
    </div>

    <!-- STATS MODAL -->
    <div id="statsModal" class="modal-overlay">
        <div class="modal-box">
            <h2>Your Statistics</h2>
            <div class="settings-grid">
                <div class="setting-item">
                    <span>Total Score</span>
                    <span id="statTotalScore">0</span>
                </div>
                <div class="setting-item">
                    <span>Total Games</span>
                    <span id="statTotalGames">0</span>
                </div>
                <div class="setting-item">
                    <span>Accuracy</span>
                    <span id="statAccuracy">0%</span>
                </div>
                <div class="setting-item">
                    <span>Best Streak</span>
                    <span id="statBestStreak">0</span>
                </div>
                <div class="setting-item">
                    <span>Training Time</span>
                    <span id="statTotalTime">0h 0m</span>
                </div>
            </div>
            <button class="btn-main" onclick="app.closeStats()">Close</button>
        </div>
    </div>

    <!-- TUTORIAL MODAL -->
    <div id="tutorialModal" class="tutorial-overlay">
        <div class="tutorial-content">
            <h3 id="tutorialTitle">How to Play</h3>
            <p id="tutorialText">Game instructions will appear here.</p>
            <button class="btn-main" onclick="app.closeTutorial()">Got it!</button>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="toast">
        <div class="toast-icon" id="toastIcon">üéØ</div>
        <div class="toast-message" id="toastMessage">Notification message</div>
    </div>

    <script>
        // --- ENHANCED AUDIO SYSTEM ---
        const audioSys = {
            ctx: null,
            enabled: true,
            init() {
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                this.enabled = localStorage.getItem('soundEnabled') !== 'false';
            },
            playTone(freq, type, duration, volume = 0.1) {
                if(!this.enabled || !this.ctx) return;
                try {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                    gain.gain.setValueAtTime(volume, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    osc.stop(this.ctx.currentTime + duration);
                } catch(e) {
                    console.log("Audio error:", e);
                }
            },
            click() { this.playTone(600, 'sine', 0.05); },
            success() { 
                this.playTone(800, 'triangle', 0.1); 
                setTimeout(() => this.playTone(1200, 'sine', 0.2), 100);
                setTimeout(() => this.playTone(1600, 'sine', 0.1), 300);
            },
            error() { this.playTone(150, 'sawtooth', 0.3); },
            levelUp() {
                this.playTone(523.25, 'sine', 0.1); // C5
                setTimeout(() => this.playTone(659.25, 'sine', 0.1), 100); // E5
                setTimeout(() => this.playTone(783.99, 'sine', 0.2), 200); // G5
            },
            toggle(enabled) {
                this.enabled = enabled;
                localStorage.setItem('soundEnabled', enabled);
                if(enabled && this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
            }
        };

        // --- VIBRATION SYSTEM ---
        const vibrationSys = {
            enabled: navigator.vibrate && localStorage.getItem('vibrationEnabled') !== 'false',
            short() { if(this.enabled) navigator.vibrate(50); },
            long() { if(this.enabled) navigator.vibrate(200); },
            pattern() { if(this.enabled) navigator.vibrate([100, 50, 100]); },
            toggle(enabled) {
                this.enabled = enabled && navigator.vibrate;
                localStorage.setItem('vibrationEnabled', enabled);
            }
        };

        // --- NOTIFICATION SYSTEM ---
        const notificationSys = {
            show(message, icon = 'üéØ', duration = 3000) {
                const toast = document.getElementById('toast');
                document.getElementById('toastIcon').textContent = icon;
                document.getElementById('toastMessage').textContent = message;
                
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), duration);
            }
        };

        // --- PROGRESS MANAGEMENT ---
        const progressManager = {
            data: {
                scores: { memory: 0, pattern: 0, math: 0 },
                levels: { memory: 1, pattern: 1, math: 1 },
                stats: {
                    totalScore: 0,
                    gamesPlayed: 0,
                    correctAnswers: 0,
                    totalAnswers: 0,
                    bestStreak: 0,
                    currentStreak: 0,
                    trainingTime: 0
                }
            },
            
            init() {
                const saved = localStorage.getItem('neurofit_progress');
                if(saved) {
                    this.data = JSON.parse(saved);
                    this.updateUI();
                }
            },
            
            save() {
                localStorage.setItem('neurofit_progress', JSON.stringify(this.data));
                this.updateUI();
            },
            
            updateUI() {
                // Update dashboard
                document.getElementById('memoryLevel').textContent = `Level ${this.data.levels.memory}`;
                document.getElementById('patternLevel').textContent = `Level ${this.data.levels.pattern}`;
                document.getElementById('mathLevel').textContent = `Level ${this.data.levels.math}`;
                document.getElementById('headerScore').textContent = this.data.stats.totalScore;
                document.getElementById('headerLevel').textContent = Math.max(...Object.values(this.data.levels));
                document.getElementById('streakCount').textContent = this.data.stats.currentStreak;
                document.getElementById('trainingTime').textContent = `${Math.floor(this.data.stats.trainingTime / 60)}m`;
                document.getElementById('highScore').textContent = this.data.stats.totalScore;
                document.getElementById('gamesPlayed').textContent = this.data.stats.gamesPlayed;
                
                // Update stats modal
                document.getElementById('statTotalScore').textContent = this.data.stats.totalScore;
                document.getElementById('statTotalGames').textContent = this.data.stats.gamesPlayed;
                const accuracy = this.data.stats.totalAnswers > 0 
                    ? Math.round((this.data.stats.correctAnswers / this.data.stats.totalAnswers) * 100)
                    : 0;
                document.getElementById('statAccuracy').textContent = `${accuracy}%`;
                document.getElementById('statBestStreak').textContent = this.data.stats.bestStreak;
                document.getElementById('statTotalTime').textContent = 
                    `${Math.floor(this.data.stats.trainingTime / 3600)}h ${Math.floor((this.data.stats.trainingTime % 3600) / 60)}m`;
            },
            
            recordGame(gameType, score, correct, total) {
                this.data.scores[gameType] += score;
                this.data.stats.totalScore += score;
                this.data.stats.gamesPlayed++;
                this.data.stats.correctAnswers += correct;
                this.data.stats.totalAnswers += total;
                
                if(correct === total) {
                    this.data.stats.currentStreak++;
                    if(this.data.stats.currentStreak > this.data.stats.bestStreak) {
                        this.data.stats.bestStreak = this.data.stats.currentStreak;
                    }
                } else {
                    this.data.stats.currentStreak = 0;
                }
                
                this.save();
            },
            
            levelUp(gameType) {
                this.data.levels[gameType] = Math.min(this.data.levels[gameType] + 1, 200);
                this.save();
            },
            
            reset() {
                this.data = {
                    scores: { memory: 0, pattern: 0, math: 0 },
                    levels: { memory: 1, pattern: 1, math: 1 },
                    stats: {
                        totalScore: 0,
                        gamesPlayed: 0,
                        correctAnswers: 0,
                        totalAnswers: 0,
                        bestStreak: 0,
                        currentStreak: 0,
                        trainingTime: 0
                    }
                };
                this.save();
                notificationSys.show('Progress reset successfully', 'üîÑ');
            }
        };

        // --- APP CORE ---
        const app = {
            state: {
                currentGame: null,
                level: 1,
                maxLevel: 200,
                score: 0,
                isPaused: false,
                startTime: null,
                timerInterval: null
            },
            els: {
                views: { 
                    home: document.getElementById('dashboard'), 
                    game: document.getElementById('gameScreen') 
                },
                game: { 
                    title: document.getElementById('gameTitle'), 
                    level: document.getElementById('gameLevel'), 
                    area: document.getElementById('gameArea'), 
                    stats: document.getElementById('gameStats'), 
                    bar: document.getElementById('progressBar'),
                    timer: document.getElementById('gameTimer'),
                    pauseBtn: document.getElementById('pauseBtn')
                },
                modals: {
                    result: document.getElementById('resultModal'),
                    settings: document.getElementById('settingsModal'),
                    stats: document.getElementById('statsModal'),
                    tutorial: document.getElementById('tutorialModal')
                }
            },

            init() {
                // Initialize systems
                audioSys.init();
                vibrationSys.enabled = localStorage.getItem('vibrationEnabled') !== 'false';
                progressManager.init();
                
                // Set initial theme
                this.updateTheme();
                
                // Initialize training time counter
                this.startTime = Date.now();
                setInterval(() => {
                    if(!this.state.isPaused) {
                        progressManager.data.stats.trainingTime++;
                        progressManager.updateUI();
                    }
                }, 1000);
                
                // Show welcome message
                setTimeout(() => {
                    if(progressManager.data.stats.gamesPlayed === 0) {
                        notificationSys.show('Welcome to NeuroFit! Start training your brain!', 'üß†');
                    }
                }, 1000);
            },

            // --- Navigation ---
            showHome() {
                this.stopGame();
                this.switchView('home');
                progressManager.updateUI();
            },
            
            switchView(v) {
                Object.values(this.els.views).forEach(e => e.classList.remove('active'));
                this.els.views[v].classList.add('active');
            },

            loadGame(type) {
                this.state.currentGame = type;
                this.state.isPaused = false;
                this.els.game.pauseBtn.textContent = '‚è∏Ô∏è';
                
                // Set initial level from progress manager
                if(type !== 'tictactoe') {
                    this.state.level = progressManager.data.levels[type];
                }
                
                this.switchView('game');
                
                // Show tutorial for first time
                if(!localStorage.getItem(`tutorial_${type}_shown`)) {
                    this.showTutorial();
                    localStorage.setItem(`tutorial_${type}_shown`, 'true');
                }
                
                // Load specific game
                if(type === 'tictactoe') tttGame.init();
                else if(type === 'memory') memoryGame.init();
                else if(type === 'pattern') patternGame.init();
                else if(type === 'math') mathGame.init();
                
                // Start game timer
                this.startGameTimer();
            },

            stopGame() {
                if(memoryGame.timer) clearInterval(memoryGame.timer);
                if(mathGame.timer) clearInterval(mathGame.timer);
                if(this.state.timerInterval) clearInterval(this.state.timerInterval);
            },

            pauseGame() {
                this.state.isPaused = !this.state.isPaused;
                this.els.game.pauseBtn.textContent = this.state.isPaused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
                
                if(this.state.isPaused) {
                    if(this.state.currentGame === 'memory') clearInterval(memoryGame.timer);
                    if(this.state.currentGame === 'math') clearInterval(mathGame.timer);
                    notificationSys.show('Game Paused', '‚è∏Ô∏è', 2000);
                } else {
                    if(this.state.currentGame === 'memory') memoryGame.startTimer();
                    if(this.state.currentGame === 'math') mathGame.startTimer();
                }
            },

            startGameTimer() {
                if(this.state.currentGame === 'tictactoe' || this.state.currentGame === 'pattern') return;
                
                let timeLeft = 30;
                this.els.game.timer.style.display = 'block';
                this.els.game.timer.textContent = this.formatTime(timeLeft);
                
                if(this.state.timerInterval) clearInterval(this.state.timerInterval);
                
                this.state.timerInterval = setInterval(() => {
                    if(!this.state.isPaused) {
                        timeLeft--;
                        this.els.game.timer.textContent = this.formatTime(timeLeft);
                        
                        // Update progress bar
                        const pct = (timeLeft / 30) * 100;
                        this.els.game.bar.style.width = `${pct}%`;
                        
                        if(timeLeft <= 0) {
                            clearInterval(this.state.timerInterval);
                            this.gameOver("Time's up!");
                        }
                        
                        // Color warning
                        if(timeLeft <= 10) {
                            this.els.game.timer.style.color = 'var(--danger)';
                            this.els.game.timer.style.animation = 'pulse 1s infinite';
                        }
                    }
                }, 1000);
            },

            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            },

            // --- Level Management ---
            updateLevelUI() {
                this.els.game.level.textContent = `Level ${this.state.level} / ${this.state.maxLevel}`;
            },

            levelComplete(points) {
                this.stopGame();
                this.state.score += points;
                audioSys.success();
                vibrationSys.pattern();
                
                // Update progress
                if(this.state.currentGame !== 'tictactoe') {
                    progressManager.recordGame(this.state.currentGame, points, 1, 1);
                    progressManager.levelUp(this.state.currentGame);
                }
                
                // Update modal
                this.els.modals.result.classList.add('active');
                document.getElementById('resIcon').textContent = 'üéØ';
                document.getElementById('resTitle').textContent = "Level Complete!";
                document.getElementById('resScore').textContent = `+${points}`;
                document.getElementById('resMsg').textContent = this.getRandomCongrats();
                
                // Update button actions
                const btn = document.querySelector('#resultModal .btn-main');
                btn.textContent = "Next Level";
                btn.onclick = () => this.nextLevel();
            },

            gameOver(msg) {
                this.stopGame();
                audioSys.error();
                vibrationSys.long();
                
                this.els.modals.result.classList.add('active');
                document.getElementById('resIcon').textContent = 'üòî';
                document.getElementById('resTitle').textContent = "Game Over";
                document.getElementById('resScore').textContent = this.state.score;
                document.getElementById('resMsg').textContent = msg;
                
                // Update button actions
                const btn = document.querySelector('#resultModal .btn-main');
                btn.textContent = "Try Again";
                btn.onclick = () => {
                    this.els.modals.result.classList.remove('active');
                    this.loadGame(this.state.currentGame);
                };
                
                // Update progress
                if(this.state.currentGame !== 'tictactoe') {
                    progressManager.recordGame(this.state.currentGame, 0, 0, 1);
                }
            },

            nextLevel() {
                this.els.modals.result.classList.remove('active');
                if (this.state.currentGame !== 'tictactoe') {
                    if(this.state.level < this.state.maxLevel) {
                        this.state.level++;
                        audioSys.levelUp();
                        notificationSys.show(`Level ${this.state.level} unlocked!`, 'üöÄ');
                    }
                }
                this.loadGame(this.state.currentGame);
            },

            getRandomCongrats() {
                const messages = [
                    "Excellent work! Your brain is getting stronger!",
                    "Impressive! You're mastering cognitive challenges!",
                    "Brilliant! Your mental agility is improving!",
                    "Outstanding! Keep pushing your limits!",
                    "Remarkable! Your focus is paying off!"
                ];
                return messages[Math.floor(Math.random() * messages.length)];
            },

            // --- Customization ---
            toggleSettings() {
                this.els.modals.settings.classList.toggle('active');
            },
            
            showStats() {
                this.els.modals.stats.classList.add('active');
            },
            
            closeStats() {
                this.els.modals.stats.classList.remove('active');
            },
            
            showTutorial() {
                const tutorials = {
                    memory: {
                        title: "Spatial Recall",
                        text: "Memorize the flashing tiles and then click them in the same order. The grid size and sequence length increase as you progress."
                    },
                    pattern: {
                        title: "Pattern Logic",
                        text: "Identify the pattern and select the missing element from the options below. Patterns become more complex at higher levels."
                    },
                    math: {
                        title: "Mental Math",
                        text: "Solve the math problem as quickly as possible. Use the number pad or type your answer and press Enter."
                    },
                    tictactoe: {
                        title: "Strategy Tac-Toe",
                        text: "Play against an unbeatable AI. Try to get three in a row while blocking the AI's moves. Can you achieve a draw?"
                    }
                };
                
                if(this.state.currentGame && tutorials[this.state.currentGame]) {
                    document.getElementById('tutorialTitle').textContent = tutorials[this.state.currentGame].title;
                    document.getElementById('tutorialText').textContent = tutorials[this.state.currentGame].text;
                    this.els.modals.tutorial.classList.add('active');
                }
            },
            
            closeTutorial() {
                this.els.modals.tutorial.classList.remove('active');
            },
            
            setTheme(hue, el) {
                document.documentElement.style.setProperty('--hue', hue);
                document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                if(el) el.classList.add('active');
                localStorage.setItem('themeHue', hue);
            },
            
            updateTheme() {
                const savedHue = localStorage.getItem('themeHue');
                if(savedHue) {
                    this.setTheme(parseInt(savedHue));
                }
            },
            
            toggleSound(enabled) {
                audioSys.toggle(enabled);
                notificationSys.show(`Sound ${enabled ? 'enabled' : 'disabled'}`, 'üîä');
            },
            
            toggleVibration(enabled) {
                vibrationSys.toggle(enabled);
                notificationSys.show(`Vibration ${enabled ? 'enabled' : 'disabled'}`, 'üì≥');
            },
            
            toggleAnimations(enabled) {
                document.body.style.animation = enabled ? '' : 'none';
                notificationSys.show(`Animations ${enabled ? 'enabled' : 'disabled'}`, '‚ú®');
            },
            
            resetProgress() {
                if(confirm("Are you sure you want to reset all progress? This cannot be undone.")) {
                    progressManager.reset();
                    this.toggleSettings();
                    this.showHome();
                }
            }
        };

        // --- ENHANCED GAME 1: MEMORY (Levels 1-200) ---
        const memoryGame = {
            grid: [], gridSize: 3, seqLen: 3, time: 0, timer: null,
            init() {
                const l = app.state.level;
                
                // Procedural Difficulty
                if(l < 20) this.gridSize = 3;
                else if(l < 50) this.gridSize = 4;
                else if(l < 100) this.gridSize = 5;
                else this.gridSize = 6;
                
                this.seqLen = 3 + Math.floor(l / 10);
                const tilesTotal = this.gridSize * this.gridSize;
                
                // Update UI
                app.els.game.title.textContent = "Spatial Recall";
                app.updateLevelUI();
                app.els.game.bar.style.width = '100%';
                
                // Generate unique sequence
                this.grid = Array(tilesTotal).fill(0);
                let filled = 0;
                const usedIndices = new Set();
                
                while(filled < Math.min(this.seqLen, tilesTotal)) {
                    let idx = Math.floor(Math.random() * tilesTotal);
                    if(!usedIndices.has(idx)) {
                        this.grid[idx] = 1;
                        usedIndices.add(idx);
                        filled++;
                    }
                }
                
                // Render grid
                const tileSize = Math.min(80, 400 / this.gridSize);
                let html = `
                    <div style="margin-bottom: 2rem; text-align: center;">
                        <div style="color: var(--text-muted); margin-bottom: 10px;">
                            Memorize ${this.seqLen} tiles
                        </div>
                    </div>
                    <div class="memory-grid" style="
                        grid-template-columns: repeat(${this.gridSize}, ${tileSize}px);
                        grid-template-rows: repeat(${this.gridSize}, ${tileSize}px);
                        gap: 8px;
                    ">
                `;
                
                for(let i=0; i<tilesTotal; i++) {
                    html += `<div class="mem-tile" id="mt${i}" onclick="memoryGame.click(${i})" 
                              style="width: ${tileSize}px; height: ${tileSize}px;"></div>`;
                }
                html += `</div>`;
                
                app.els.game.area.innerHTML = html;
                
                // Play sequence with delay
                setTimeout(() => this.playSequence(), 1000);
            },
            
            playSequence() {
                let i = 0;
                const activeIndices = this.grid.map((val, idx) => val === 1 ? idx : -1).filter(idx => idx !== -1);
                
                const playNext = () => {
                    if(i >= activeIndices.length) {
                        document.getElementById('memMsg').textContent = "Your turn! Repeat the pattern";
                        this.startTimer();
                        return;
                    }
                    
                    const idx = activeIndices[i];
                    const tile = document.getElementById(`mt${idx}`);
                    
                    tile.classList.add('active');
                    audioSys.click();
                    vibrationSys.short();
                    
                    setTimeout(() => {
                        tile.classList.remove('active');
                        i++;
                        setTimeout(playNext, 300);
                    }, 500);
                };
                
                app.els.game.area.innerHTML = app.els.game.area.innerHTML.replace('</div>', 
                    `<p id="memMsg" style="text-align:center; color:var(--text-muted); margin-top:20px;">
                        Watch carefully...
                    </p></div>`);
                
                setTimeout(playNext, 500);
            },
            
            startTimer() {
                this.time = this.seqLen * 1.5 + 5;
                this.timer = setInterval(() => {
                    if(!app.state.isPaused) {
                        this.time -= 0.1;
                        const pct = (this.time / (this.seqLen * 1.5 + 5)) * 100;
                        app.els.game.bar.style.width = `${pct}%`;
                        
                        if(this.time <= 0) {
                            clearInterval(this.timer);
                            app.gameOver("Time ran out!");
                        }
                    }
                }, 100);
            },
            
            click(idx) {
                if(this.timer && this.grid[idx] === 1) {
                    audioSys.click();
                    vibrationSys.short();
                    
                    const tile = document.getElementById(`mt${idx}`);
                    tile.classList.add('found');
                    this.grid[idx] = 2;
                    
                    // Check win
                    if(!this.grid.includes(1)) {
                        clearInterval(this.timer);
                        setTimeout(() => {
                            app.levelComplete(100 + app.state.level * 10);
                        }, 500);
                    }
                } else if (this.timer && this.grid[idx] === 0) {
                    audioSys.error();
                    vibrationSys.long();
                    
                    const tile = document.getElementById(`mt${idx}`);
                    tile.classList.add('wrong');
                    setTimeout(() => {
                        tile.classList.remove('wrong');
                        app.gameOver("Wrong tile!");
                    }, 300);
                }
            }
        };

        // --- ENHANCED GAME 2: PATTERN (Levels 1-200) ---
        const patternGame = {
            currentQuestion: null,
            init() {
                const l = app.state.level;
                app.els.game.title.textContent = "Pattern Logic";
                app.updateLevelUI();
                app.els.game.bar.style.width = '100%';
                
                this.currentQuestion = this.generateQuestion(l);
                this.render(this.currentQuestion);
            },
            
            generateQuestion(l) {
                const types = [
                    'arithmetic', 'geometric', 'fibonacci', 'power', 
                    'alternating', 'prime', 'square', 'mixed'
                ];
                
                let typeIndex = Math.floor(l / 25);
                if(typeIndex >= types.length) typeIndex = types.length - 1;
                
                let seq = [], ans = 0, disp = [];
                const type = types[typeIndex];
                
                switch(type) {
                    case 'arithmetic':
                        let start = Math.floor(Math.random() * 20) + 1;
                        let diff = Math.floor(Math.random() * 8) + 2;
                        for(let i=0; i<4; i++) seq.push(start + (diff * i));
                        ans = start + (diff * 4);
                        break;
                        
                    case 'geometric':
                        start = Math.floor(Math.random() * 5) + 1;
                        let ratio = Math.floor(Math.random() * 3) + 2;
                        for(let i=0; i<4; i++) seq.push(start * Math.pow(ratio, i));
                        ans = start * Math.pow(ratio, 4);
                        break;
                        
                    case 'fibonacci':
                        start = Math.floor(Math.random() * 5) + 1;
                        let next = Math.floor(Math.random() * 5) + start + 1;
                        seq.push(start, next, start + next, next + (start + next));
                        ans = (start + next) + (next + (start + next));
                        break;
                        
                    case 'square':
                        start = Math.floor(Math.random() * 5) + 1;
                        for(let i=0; i<4; i++) seq.push(Math.pow(start + i, 2));
                        ans = Math.pow(start + 4, 2);
                        break;
                        
                    default: // mixed
                        start = Math.floor(Math.random() * 10) + 1;
                        seq = [start, start * 2, start * 2 + 1, (start * 2 + 1) * 2];
                        ans = (start * 2 + 1) * 2 + 1;
                }
                
                // Generate options with distractors
                let opts = [ans];
                while(opts.length < 4) {
                    let fake;
                    if(type === 'arithmetic') {
                        fake = ans + (Math.random() > 0.5 ? diff : -diff) * (Math.floor(Math.random() * 2) + 1);
                    } else if(type === 'geometric') {
                        fake = ans * (Math.random() > 0.5 ? ratio : 1/ratio);
                    } else {
                        fake = ans + Math.floor(Math.random() * 20) - 10;
                    }
                    
                    fake = Math.round(fake);
                    if(fake > 0 && !opts.includes(fake) && fake !== ans) {
                        opts.push(fake);
                    }
                }
                
                opts.sort(() => Math.random() - 0.5);
                return { seq, ans, opts, type };
            },
            
            render(q) {
                let html = `
                    <div class="pattern-container">
                        <div style="color: var(--text-muted); margin-bottom: 1rem;">
                            Identify the pattern and select the missing number
                        </div>
                        <div class="pattern-row">
                `;
                
                // Show first 4 numbers
                q.seq.forEach(num => {
                    html += `<div class="pat-item">${num}</div>`;
                });
                
                // Question mark
                html += `<div class="pat-item q">?</div></div>`;
                
                // Options
                html += `<div class="pat-options">`;
                q.opts.forEach((opt, idx) => {
                    html += `<button class="pat-opt" onclick="patternGame.check(${opt}, ${q.ans})">${opt}</button>`;
                });
                html += `</div>`;
                
                // Pattern type hint
                html += `<div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 1rem;">
                    Pattern type: ${q.type}
                </div>`;
                
                app.els.game.area.innerHTML = html + '</div>';
            },
            
            check(val, ans) {
                const buttons = document.querySelectorAll('.pat-opt');
                buttons.forEach(btn => btn.disabled = true);
                
                if(val == ans) {
                    audioSys.success();
                    vibrationSys.pattern();
                    document.querySelector(`.pat-opt:nth-child(${this.currentQuestion.opts.indexOf(val) + 1})`)
                        .classList.add('correct');
                    
                    setTimeout(() => {
                        app.levelComplete(120 + app.state.level * 8);
                    }, 800);
                } else {
                    audioSys.error();
                    vibrationSys.long();
                    document.querySelector(`.pat-opt:nth-child(${this.currentQuestion.opts.indexOf(val) + 1})`)
                        .classList.add('incorrect');
                    
                    setTimeout(() => {
                        app.gameOver(`Incorrect! The pattern was ${this.currentQuestion.type}`);
                    }, 1000);
                }
            }
        };

        // --- ENHANCED GAME 3: MATH (Levels 1-200) ---
        const mathGame = {
            timer: null,
            timeLeft: 30,
            currentProblem: null,
            
            init() {
                const l = app.state.level;
                app.els.game.title.textContent = "Mental Math";
                app.updateLevelUI();
                
                this.timeLeft = Math.max(15, 30 - Math.floor(l / 10));
                this.currentProblem = this.generateProblem(l);
                
                this.render(this.currentProblem);
                this.startTimer();
            },
            
            generateProblem(l) {
                let maxNum = 20 + l * 3;
                let ops = ['+', '-'];
                
                if(l > 30) ops.push('√ó');
                if(l > 60) {
                    ops.push('√∑');
                    maxNum += 50;
                }
                
                const op = ops[Math.floor(Math.random() * ops.length)];
                let a, b, answer;
                
                if(op === '√ó') {
                    a = Math.floor(Math.random() * 12) + 1;
                    b = Math.floor(Math.random() * 12) + 1;
                    answer = a * b;
                } else if(op === '√∑') {
                    b = Math.floor(Math.random() * 12) + 1;
                    answer = Math.floor(Math.random() * 12) + 1;
                    a = answer * b;
                } else if(op === '-') {
                    a = Math.floor(Math.random() * maxNum) + 10;
                    b = Math.floor(Math.random() * (a - 1)) + 1;
                    answer = a - b;
                } else {
                    a = Math.floor(Math.random() * maxNum) + 1;
                    b = Math.floor(Math.random() * maxNum) + 1;
                    answer = a + b;
                }
                
                return { a, b, op, answer };
            },
            
            render(problem) {
                const displayOp = problem.op === '√ó' ? '√ó' : (problem.op === '√∑' ? '√∑' : problem.op);
                
                app.els.game.area.innerHTML = `
                    <div class="math-game">
                        <div class="math-display">
                            ${problem.a} ${displayOp} ${problem.b} = ?
                        </div>
                        <input 
                            type="number" 
                            id="mathIn" 
                            class="math-input" 
                            autofocus
                            placeholder="Enter answer"
                            onkeypress="if(event.key === 'Enter') mathGame.submit()"
                        >
                        <div style="margin-top: 1rem; display: flex; gap: 10px;">
                            <button class="btn-main" onclick="mathGame.submit()">
                                Submit Answer
                            </button>
                            <button class="btn-secondary" onclick="mathGame.skip()">
                                Skip
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('mathIn').focus();
            },
            
            startTimer() {
                if(this.timer) clearInterval(this.timer);
                
                this.timer = setInterval(() => {
                    if(!app.state.isPaused) {
                        this.timeLeft--;
                        const pct = (this.timeLeft / 30) * 100;
                        app.els.game.bar.style.width = `${pct}%`;
                        
                        if(this.timeLeft <= 0) {
                            clearInterval(this.timer);
                            app.gameOver("Time's up!");
                        }
                    }
                }, 1000);
            },
            
            submit() {
                const input = document.getElementById('mathIn');
                const userAnswer = parseInt(input.value);
                
                if(isNaN(userAnswer)) {
                    input.classList.add('incorrect');
                    setTimeout(() => input.classList.remove('incorrect'), 300);
                    return;
                }
                
                if(userAnswer === this.currentProblem.answer) {
                    audioSys.success();
                    vibrationSys.pattern();
                    input.classList.add('correct');
                    
                    clearInterval(this.timer);
                    setTimeout(() => {
                        app.levelComplete(150 + Math.max(0, this.timeLeft) * 5);
                    }, 500);
                } else {
                    audioSys.error();
                    vibrationSys.long();
                    input.classList.add('incorrect');
                    
                    setTimeout(() => {
                        app.gameOver(`Incorrect! ${this.currentProblem.a} ${this.currentProblem.op} ${this.currentProblem.b} = ${this.currentProblem.answer}`);
                    }, 1000);
                }
            },
            
            skip() {
                clearInterval(this.timer);
                app.gameOver(`The answer was ${this.currentProblem.answer}`);
            }
        };

        // --- ENHANCED GAME 4: TIC TAC TOE (MINIMAX) ---
        const tttGame = {
            board: Array(9).fill(null),
            human: 'x', 
            ai: 'o',
            scores: { wins: 0, losses: 0, draws: 0 },
            
            init() {
                app.els.game.title.textContent = "Strategy Tac-Toe";
                app.els.game.level.textContent = "Unbeatable AI";
                app.els.game.bar.style.width = '100%';
                
                // Load scores
                const savedScores = localStorage.getItem('ttt_scores');
                if(savedScores) {
                    this.scores = JSON.parse(savedScores);
                }
                
                this.board.fill(null);
                this.render();
            },
            
            saveScores() {
                localStorage.setItem('ttt_scores', JSON.stringify(this.scores));
            },
            
            render() {
                let html = `
                    <div class="ttt-game">
                        <div class="ttt-info">
                            You are <span style="color:var(--danger); font-weight:bold;">X</span>
                            vs Unbeatable AI <span style="color:var(--success); font-weight:bold;">O</span>
                        </div>
                        <div class="ttt-grid">
                `;
                
                this.board.forEach((cell, index) => {
                    const symbol = cell === 'x' ? 'X' : (cell === 'o' ? 'O' : '');
                    const className = `ttt-cell ${cell || ''}`;
                    html += `<div class="${className}" onclick="tttGame.move(${index})">${symbol}</div>`;
                });
                
                html += `</div>`;
                
                // Score display
                html += `
                    <div class="ttt-score">
                        <div class="ttt-score-item">
                            <span>Wins</span>
                            <span style="color:var(--success);">${this.scores.wins}</span>
                        </div>
                        <div class="ttt-score-item">
                            <span>Draws</span>
                            <span style="color:var(--text-muted);">${this.scores.draws}</span>
                        </div>
                        <div class="ttt-score-item">
                            <span>Losses</span>
                            <span style="color:var(--danger);">${this.scores.losses}</span>
                        </div>
                    </div>
                    <button class="btn-text" style="justify-content:center; margin-top:20px;" onclick="tttGame.init()">
                        New Game
                    </button>
                `;
                
                app.els.game.area.innerHTML = html + '</div>';
            },
            
            move(index) {
                if(this.board[index] || this.checkWinner()) return;
                
                audioSys.click();
                vibrationSys.short();
                this.board[index] = this.human;
                this.render();
                
                if(this.checkWinner() === 'x') {
                    this.scores.wins++;
                    this.saveScores();
                    setTimeout(() => this.showResult("You Won! (Impossible!)", 'win'), 500);
                    return;
                }
                
                if(this.isBoardFull()) {
                    this.scores.draws++;
                    this.saveScores();
                    setTimeout(() => this.showResult("Draw! Perfect play.", 'draw'), 500);
                    return;
                }
                
                // AI Turn
                setTimeout(() => {
                    const bestMove = this.minimax(this.board, this.ai).index;
                    this.board[bestMove] = this.ai;
                    audioSys.click();
                    this.render();
                    
                    if(this.checkWinner() === 'o') {
                        this.scores.losses++;
                        this.saveScores();
                        setTimeout(() => this.showResult("AI Wins!", 'loss'), 500);
                    } else if(this.isBoardFull()) {
                        this.scores.draws++;
                        this.saveScores();
                        setTimeout(() => this.showResult("Draw!", 'draw'), 500);
                    }
                }, 600);
            },
            
            checkWinner() {
                const winPatterns = [
                    [0,1,2],[3,4,5],[6,7,8], // rows
                    [0,3,6],[1,4,7],[2,5,8], // columns
                    [0,4,8],[2,4,6]          // diagonals
                ];
                
                for(const pattern of winPatterns) {
                    const [a,b,c] = pattern;
                    if(this.board[a] && this.board[a] === this.board[b] && this.board[a] === this.board[c]) {
                        // Highlight winning cells
                        pattern.forEach(idx => {
                            const cell = document.querySelector(`.ttt-cell:nth-child(${idx + 1})`);
                            if(cell) cell.classList.add('win');
                        });
                        return this.board[a];
                    }
                }
                return null;
            },
            
            isBoardFull() {
                return !this.board.includes(null);
            },
            
            minimax(board, player) {
                const winner = this.checkWinner();
                if(winner === this.ai) return { score: 10 };
                if(winner === this.human) return { score: -10 };
                if(!board.includes(null)) return { score: 0 };
                
                const moves = [];
                const availSpots = board.map((spot, idx) => spot === null ? idx : null)
                                       .filter(spot => spot !== null);
                
                for(const spot of availSpots) {
                    const move = { index: spot };
                    board[spot] = player;
                    
                    if(player === this.ai) {
                        move.score = this.minimax(board, this.human).score;
                    } else {
                        move.score = this.minimax(board, this.ai).score;
                    }
                    
                    board[spot] = null;
                    moves.push(move);
                }
                
                let bestMove;
                if(player === this.ai) {
                    let bestScore = -Infinity;
                    for(let i = 0; i < moves.length; i++) {
                        if(moves[i].score > bestScore) {
                            bestScore = moves[i].score;
                            bestMove = i;
                        }
                    }
                } else {
                    let bestScore = Infinity;
                    for(let i = 0; i < moves.length; i++) {
                        if(moves[i].score < bestScore) {
                            bestScore = moves[i].score;
                            bestMove = i;
                        }
                    }
                }
                
                return moves[bestMove];
            },
            
            showResult(message, type) {
                const icons = {
                    win: 'üèÜ',
                    draw: 'ü§ù',
                    loss: 'ü§ñ'
                };
                
                const titles = {
                    win: 'Incredible Victory!',
                    draw: 'Stalemate!',
                    loss: 'AI Dominates!'
                };
                
                notificationSys.show(message, icons[type]);
                
                // Update stats in real-time
                this.saveScores();
                this.render();
            }
        };

        // Initialize the app when page loads
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
            
            // Resume audio context on user interaction
            document.addEventListener('click', () => {
                if(audioSys.ctx && audioSys.ctx.state === 'suspended') {
                    audioSys.ctx.resume();
                }
            }, { once: true });
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if(document.hidden) {
                app.state.isPaused = true;
                if(app.els.game.pauseBtn) {
                    app.els.game.pauseBtn.textContent = '‚ñ∂Ô∏è';
                }
            }
        });
    </script>
</body>
</html>